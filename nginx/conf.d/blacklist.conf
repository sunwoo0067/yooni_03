# IP 차단 목록 (fail2ban과 연동)
# 이 파일은 fail2ban에 의해 자동 관리됨

# 기본 차단 IP 맵
map $remote_addr $blocked_ip {
    default 0;
    # 예시: 차단할 IP들
    # 192.168.1.100 1;
    # 10.0.0.50 1;
}

# 악성 User-Agent 패턴
map $http_user_agent $blocked_ua {
    default 0;
    ~*(?i)(sqlmap|nmap|nikto|masscan|zmap) 1;
    ~*(?i)(havij|pangolin|sqlninja) 1;
    ~*(?i)(acunetix|netsparker|appscan) 1;
    ~*(?i)(burpsuite|owasp\s*zap) 1;
    ~*(?i)(python-requests|curl|wget) 0;  # 정상적인 도구들은 허용
}

# 의심스러운 요청 패턴
map $request_uri $blocked_uri {
    default 0;
    ~*(?i)(\.\./|\.\.\\) 1;  # 디렉토리 순회 공격
    ~*(?i)(union.*select|select.*from) 1;  # SQL 인젝션
    ~*(?i)(<script|javascript:|vbscript:) 1;  # XSS 공격
    ~*(?i)(php://|file://|data://) 1;  # 파일 인클루전 공격
    ~*(?i)(cmd=|exec\(|eval\(|system\() 1;  # 명령어 실행 시도
}

# 국가별 차단 (GeoIP2가 설정된 경우)
# map $geoip2_data_country_code $blocked_country {
#     default 0;
#     CN 1;  # 중국
#     RU 1;  # 러시아
#     KP 1;  # 북한
# }